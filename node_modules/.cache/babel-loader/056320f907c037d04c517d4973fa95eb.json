{"ast":null,"code":"import _objectSpread from \"/Users/ChampionRobert/StudioProjectsInTrial/CRATE-ALTS/fullstack-javascript-architecture-configd/frontend/web-iso/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"/Users/ChampionRobert/StudioProjectsInTrial/CRATE-ALTS/fullstack-javascript-architecture-configd/frontend/web-iso/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ChampionRobert/StudioProjectsInTrial/CRATE-ALTS/fullstack-javascript-architecture-configd/frontend/web-iso/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n// Imports\nimport axios from 'axios'; // App Imports\n\nimport { API_URL } from '../../../../setup/config/env';\nimport { MESSAGE_SHOW } from '../../../common/api/actions';\nimport { LOGIN_REQUEST, LOGIN_RESPONSE, SET_USER, LOGOUT } from './types'; // Actions\n// Login a user using credentials\n\nexport function login(_ref) {\n  var email = _ref.email,\n      password = _ref.password;\n  var isLoading = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n      var _yield$axios$post, data, message;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch({\n                type: LOGIN_REQUEST,\n                isLoading\n              });\n              dispatch({\n                type: MESSAGE_SHOW,\n                message: 'Please wait..'\n              });\n              _context.prev = 2;\n              _context.next = 5;\n              return axios.post(API_URL, {\n                operation: 'userLogin',\n                params: {\n                  email,\n                  password\n                }\n              });\n\n            case 5:\n              _yield$axios$post = _context.sent;\n              data = _yield$axios$post.data;\n              message = '';\n\n              if (data.success) {\n                dispatch(setUser(data.data.token, data.data.user));\n                setUserLocally(data.data.token, data.data.user);\n                message = \"Login successful. Welcome back, \".concat(data.data.user.name, \".\");\n              } else {\n                message = data.message;\n              }\n\n              dispatch({\n                type: MESSAGE_SHOW,\n                message\n              });\n              _context.next = 16;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](2);\n              console.log(_context.t0);\n              dispatch({\n                type: MESSAGE_SHOW,\n                message: 'Please try again.'\n              });\n\n            case 16:\n              _context.prev = 16;\n              dispatch({\n                type: LOGIN_RESPONSE\n              });\n              return _context.finish(16);\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 12, 16, 19]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n} // Log out user and remove token from local (AsyncStorage)\n\nexport function logout() {\n  return function (dispatch) {\n    unsetUserLocally();\n    dispatch({\n      type: LOGOUT\n    });\n  };\n} // Set a user after login or using local (AsyncStorage) token\n\nexport function setUser(token, user) {\n  if (token) {\n    axios.defaults.headers.common['Authentication'] = \"Bearer \".concat(token);\n  } else {\n    delete axios.defaults.headers.common['Authentication'];\n  }\n\n  return {\n    type: SET_USER,\n    user\n  };\n} // Get list\n\nexport function getList() {\n  return axios.post(API_URL, {\n    operation: 'userList'\n  });\n} // Get count\n\nexport function getDashboardCount() {\n  return axios.post(API_URL, {\n    operation: 'userDashboardCount'\n  });\n} // Set user token and info locally (AsyncStorage)\n\nexport function setUserLocally(token, user) {\n  // Set token\n  window.localStorage.setItem('token', token);\n  window.localStorage.setItem('user', JSON.stringify(user));\n} // Unset user token and info locally (AsyncStorage)\n\nexport function unsetUserLocally() {\n  // Remove token\n  window.localStorage.removeItem('token');\n  window.localStorage.removeItem('user'); // Remove cached data\n\n  for (var _i = 0, _Object$keys = Object.keys(_objectSpread({}, window.localStorage)); _i < _Object$keys.length; _i++) {\n    var item = _Object$keys[_i];\n\n    if (item.indexOf('CACHE.KEY.') !== -1) {\n      window.localStorage.removeItem(item);\n    }\n  }\n}","map":{"version":3,"sources":["/Users/ChampionRobert/StudioProjectsInTrial/CRATE-ALTS/fullstack-javascript-architecture-configd/frontend/web-iso/src/modules/user/api/actions/query.js"],"names":["axios","API_URL","MESSAGE_SHOW","LOGIN_REQUEST","LOGIN_RESPONSE","SET_USER","LOGOUT","login","email","password","isLoading","dispatch","type","message","post","operation","params","data","success","setUser","token","user","setUserLocally","name","console","log","logout","unsetUserLocally","defaults","headers","common","getList","getDashboardCount","window","localStorage","setItem","JSON","stringify","removeItem","Object","keys","item","indexOf"],"mappings":";;;AAAA;AACA,OAAOA,KAAP,MAAkB,OAAlB,C,CAEA;;AACA,SAASC,OAAT,QAAwB,8BAAxB;AACA,SAASC,YAAT,QAA6B,6BAA7B;AACA,SAASC,aAAT,EAAwBC,cAAxB,EAAwCC,QAAxC,EAAkDC,MAAlD,QAAgE,SAAhE,C,CAEA;AAEA;;AACA,OAAO,SAASC,KAAT,OAAsD;AAAA,MAArCC,KAAqC,QAArCA,KAAqC;AAAA,MAA9BC,QAA8B,QAA9BA,QAA8B;AAAA,MAAlBC,SAAkB,uEAAN,IAAM;AAC3D;AAAA,yEAAO,iBAAMC,QAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AACLA,cAAAA,QAAQ,CAAC;AACPC,gBAAAA,IAAI,EAAET,aADC;AAEPO,gBAAAA;AAFO,eAAD,CAAR;AAKAC,cAAAA,QAAQ,CAAC;AACPC,gBAAAA,IAAI,EAAEV,YADC;AAEPW,gBAAAA,OAAO,EAAE;AAFF,eAAD,CAAR;AANK;AAAA;AAAA,qBAYoBb,KAAK,CAACc,IAAN,CAAWb,OAAX,EAAqB;AAC1Cc,gBAAAA,SAAS,EAAE,WAD+B;AAE1CC,gBAAAA,MAAM,EAAE;AAAER,kBAAAA,KAAF;AAASC,kBAAAA;AAAT;AAFkC,eAArB,CAZpB;;AAAA;AAAA;AAYKQ,cAAAA,IAZL,qBAYKA,IAZL;AAiBCJ,cAAAA,OAjBD,GAiBW,EAjBX;;AAmBH,kBAAGI,IAAI,CAACC,OAAR,EAAiB;AACfP,gBAAAA,QAAQ,CAACQ,OAAO,CAACF,IAAI,CAACA,IAAL,CAAUG,KAAX,EAAkBH,IAAI,CAACA,IAAL,CAAUI,IAA5B,CAAR,CAAR;AAEAC,gBAAAA,cAAc,CAACL,IAAI,CAACA,IAAL,CAAUG,KAAX,EAAkBH,IAAI,CAACA,IAAL,CAAUI,IAA5B,CAAd;AAEAR,gBAAAA,OAAO,6CAAuCI,IAAI,CAACA,IAAL,CAAUI,IAAV,CAAeE,IAAtD,MAAP;AACD,eAND,MAMO;AACLV,gBAAAA,OAAO,GAAGI,IAAI,CAACJ,OAAf;AACD;;AAEDF,cAAAA,QAAQ,CAAC;AACPC,gBAAAA,IAAI,EAAEV,YADC;AAEPW,gBAAAA;AAFO,eAAD,CAAR;AA7BG;AAAA;;AAAA;AAAA;AAAA;AAkCHW,cAAAA,OAAO,CAACC,GAAR;AACAd,cAAAA,QAAQ,CAAC;AACPC,gBAAAA,IAAI,EAAEV,YADC;AAEPW,gBAAAA,OAAO,EAAE;AAFF,eAAD,CAAR;;AAnCG;AAAA;AAwCHF,cAAAA,QAAQ,CAAC;AACPC,gBAAAA,IAAI,EAAER;AADC,eAAD,CAAR;AAxCG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAP;;AAAA;AAAA;AAAA;AAAA;AA6CD,C,CAED;;AACA,OAAO,SAASsB,MAAT,GAAkB;AACvB,SAAO,UAAAf,QAAQ,EAAI;AACjBgB,IAAAA,gBAAgB;AAEhBhB,IAAAA,QAAQ,CAAC;AACPC,MAAAA,IAAI,EAAEN;AADC,KAAD,CAAR;AAGD,GAND;AAOD,C,CAED;;AACA,OAAO,SAASa,OAAT,CAAiBC,KAAjB,EAAwBC,IAAxB,EAA8B;AACnC,MAAID,KAAJ,EAAW;AACTpB,IAAAA,KAAK,CAAC4B,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,gBAA9B,qBAA4DV,KAA5D;AACD,GAFD,MAEO;AACL,WAAOpB,KAAK,CAAC4B,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,gBAA9B,CAAP;AACD;;AAED,SAAO;AACLlB,IAAAA,IAAI,EAAEP,QADD;AAELgB,IAAAA;AAFK,GAAP;AAID,C,CAED;;AACA,OAAO,SAASU,OAAT,GAAmB;AACxB,SAAO/B,KAAK,CAACc,IAAN,CAAWb,OAAX,EAAoB;AACzBc,IAAAA,SAAS,EAAE;AADc,GAApB,CAAP;AAGD,C,CAED;;AACA,OAAO,SAASiB,iBAAT,GAA6B;AAClC,SAAOhC,KAAK,CAACc,IAAN,CAAWb,OAAX,EAAoB;AACzBc,IAAAA,SAAS,EAAE;AADc,GAApB,CAAP;AAGD,C,CAED;;AACA,OAAO,SAASO,cAAT,CAAwBF,KAAxB,EAA+BC,IAA/B,EAAqC;AAC1C;AACAY,EAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,OAA5B,EAAqCf,KAArC;AACAa,EAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,MAA5B,EAAoCC,IAAI,CAACC,SAAL,CAAehB,IAAf,CAApC;AACD,C,CAED;;AACA,OAAO,SAASM,gBAAT,GAA4B;AACjC;AACAM,EAAAA,MAAM,CAACC,YAAP,CAAoBI,UAApB,CAA+B,OAA/B;AACAL,EAAAA,MAAM,CAACC,YAAP,CAAoBI,UAApB,CAA+B,MAA/B,EAHiC,CAKjC;;AACA,kCAAgBC,MAAM,CAACC,IAAP,mBAAgBP,MAAM,CAACC,YAAvB,EAAhB,kCAAuD;AAAnD,QAAIO,IAAI,mBAAR;;AACF,QAAGA,IAAI,CAACC,OAAL,CAAa,YAAb,MAA+B,CAAC,CAAnC,EAAsC;AACpCT,MAAAA,MAAM,CAACC,YAAP,CAAoBI,UAApB,CAA+BG,IAA/B;AACD;AACF;AACF","sourcesContent":["// Imports\nimport axios from 'axios'\n\n// App Imports\nimport { API_URL } from '../../../../setup/config/env'\nimport { MESSAGE_SHOW } from '../../../common/api/actions'\nimport { LOGIN_REQUEST, LOGIN_RESPONSE, SET_USER, LOGOUT } from './types'\n\n// Actions\n\n// Login a user using credentials\nexport function login({ email, password }, isLoading = true) {\n  return async dispatch => {\n    dispatch({\n      type: LOGIN_REQUEST,\n      isLoading\n    })\n\n    dispatch({\n      type: MESSAGE_SHOW,\n      message: 'Please wait..'\n    })\n\n    try {\n      const { data } = await axios.post(API_URL,  {\n        operation: 'userLogin',\n        params: { email, password }\n      })\n\n      let message = ''\n\n      if(data.success) {\n        dispatch(setUser(data.data.token, data.data.user))\n\n        setUserLocally(data.data.token, data.data.user)\n\n        message = `Login successful. Welcome back, ${ data.data.user.name }.`\n      } else {\n        message = data.message\n      }\n\n      dispatch({\n        type: MESSAGE_SHOW,\n        message\n      })\n    } catch(error) {\n      console.log(error)\n      dispatch({\n        type: MESSAGE_SHOW,\n        message: 'Please try again.'\n      })\n    } finally {\n      dispatch({\n        type: LOGIN_RESPONSE\n      })\n    }\n  }\n}\n\n// Log out user and remove token from local (AsyncStorage)\nexport function logout() {\n  return dispatch => {\n    unsetUserLocally()\n\n    dispatch({\n      type: LOGOUT\n    })\n  }\n}\n\n// Set a user after login or using local (AsyncStorage) token\nexport function setUser(token, user) {\n  if (token) {\n    axios.defaults.headers.common['Authentication'] = `Bearer ${token}`;\n  } else {\n    delete axios.defaults.headers.common['Authentication'];\n  }\n\n  return {\n    type: SET_USER,\n    user\n  }\n}\n\n// Get list\nexport function getList() {\n  return axios.post(API_URL, {\n    operation: 'userList'\n  })\n}\n\n// Get count\nexport function getDashboardCount() {\n  return axios.post(API_URL, {\n    operation: 'userDashboardCount'\n  })\n}\n\n// Set user token and info locally (AsyncStorage)\nexport function setUserLocally(token, user) {\n  // Set token\n  window.localStorage.setItem('token', token)\n  window.localStorage.setItem('user', JSON.stringify(user))\n}\n\n// Unset user token and info locally (AsyncStorage)\nexport function unsetUserLocally() {\n  // Remove token\n  window.localStorage.removeItem('token')\n  window.localStorage.removeItem('user')\n\n  // Remove cached data\n  for(let item of Object.keys({...window.localStorage})) {\n    if(item.indexOf('CACHE.KEY.') !== -1) {\n      window.localStorage.removeItem(item)\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}